<!DOCTYPE html>
<!-- 
    文档类型声明：告诉浏览器这是一个 HTML5 文档
    HTML5 是目前最新的 HTML 标准
-->
<html lang="zh-CN">
<!-- 
    html 标签：整个网页的根元素
    lang="zh-CN" 表示页面主要语言是简体中文
    这有助于搜索引擎和屏幕阅读器理解页面内容
-->

<head>
    <!-- 
        head 标签：包含页面的元数据（metadata）
        元数据是关于页面的信息，不会直接显示在页面上
    -->

    <!-- 字符编码：使用 UTF-8，支持所有语言的字符 -->
    <meta charset="UTF-8">

    <!-- 
        视口设置：让页面在移动设备上正确显示
        width=device-width：宽度等于设备宽度
        initial-scale=1.0：初始缩放比例为 1（不缩放）
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 页面标题：显示在浏览器标签页上 -->
    <title>Signal Attenuation // Terminal Access</title>

    <!-- 
        引入 Tailwind CSS 框架
        Tailwind 是一个实用优先的 CSS 框架，提供了大量预定义的样式类
        通过 CDN（内容分发网络）加载，无需下载到本地
    -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 
        引入 Google Fonts 字体
        - Noto Sans SC：思源黑体，优雅的中文无衬线字体
        - Noto Serif SC：思源宋体，优雅的中文衬线字体
        - JetBrains Mono：等宽字体，适合代码和终端文本
    -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;400;700&family=Noto+Serif+SC:wght@700&family=JetBrains+Mono:wght@100;200;400&display=swap"
        rel="stylesheet">

    <!-- 引入 Polyfill：确保旧浏览器支持 ES6 特性 -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- 引入 MathJax 配置文件：配置数学公式的渲染规则 -->
    <script src="js/config.js"></script>

    <!-- 
        引入 MathJax 库：用于渲染数学公式
        async 表示异步加载，不阻塞页面渲染
    -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- 引入自定义 CSS 文件 -->
    <link rel="stylesheet" href="css/variables.css"> <!-- CSS 变量和主题配置 -->
    <link rel="stylesheet" href="css/base.css"> <!-- 基础样式 -->
    <link rel="stylesheet" href="css/animations.css"> <!-- 动画效果 -->
    <link rel="stylesheet" href="css/components.css"> <!-- 组件样式 -->

    <!-- 
        网站图标（Favicon）
        不同浏览器和设备会使用不同尺寸的图标
    -->
    <!-- 标准浏览器图标（16x16 和 32x32） -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">

    <!-- Apple 设备图标（用于添加到主屏幕时显示） -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">
</head>

<body>
    <!-- 
        body 标签：包含页面的可见内容
        用户在浏览器中看到的所有内容都在这里
    -->

    <!-- 屏幕覆盖层：创建 CRT 显示器的扫描线效果 -->
    <div class="overlay"></div>

    <!-- 背景采样点容器：将通过 JavaScript 动态生成小圆点 -->
    <div class="sampling-dots" id="dots"></div>

    <!-- 
        页面头部区域
        max-w-7xl：最大宽度 7xl（约 1280px）
        mx-auto：水平居中
        pt/pb：上下内边距（padding top/bottom）
        px：左右内边距（padding x轴）
    -->
    <header class="max-w-7xl mx-auto pt-12 sm:pt-16 md:pt-20 pb-6 sm:pb-8 md:pb-10 px-4 sm:px-6">
        <!-- 
            顶部小标题
            mono：等宽字体
            tracking：字间距
            text-[var(--primary)]/50：使用主色调，50% 不透明度
        -->
        <p
            class="mono text-xs sm:text-sm tracking-[0.3em] sm:tracking-[0.5em] text-[var(--primary)]/50 mb-4 opacity-70">
            ACCESS GRANTED // PROTOCOL_V4.22
        </p>

        <!-- 
            主标题
            flex flex-wrap：弹性布局，允许换行
            gap：元素间距
            响应式字体大小：text-4xl（手机）→ text-5xl（平板）→ text-7xl（桌面）
        -->
        <h1
            class="flex flex-wrap items-baseline gap-2 sm:gap-4 text-4xl sm:text-5xl md:text-7xl font-thin tracking-tighter mb-6">
            <!-- 
                故障文字效果
                data-text 属性用于 CSS 伪元素创建重影
            -->
            <span class="glitch-text relative inline-block whitespace-nowrap text-4xl sm:text-6xl md:text-8xl"
                data-text="ATENUACIÓN DE LA SEÑAL">信号衰减</span>

            <!-- 
                副标题
                block sm:inline：手机上独占一行，平板及以上显示在同一行
            -->
            <span
                class="protocol-text opacity-40 tracking-[0.2em] sm:tracking-[0.3em] uppercase block sm:inline text-base sm:text-2xl md:text-4xl mono">
                SIGNAL ATTENUATION
            </span>
        </h1>

        <!-- 引言文字：使用衬线字体，斜体 -->
        <div class="max-w-5xl mt-8 grid gap-8">
            <!-- Chinese: Input Signal (Context) -->
            <div class="flex flex-col gap-2 opacity-50 hover:opacity-80 transition-opacity duration-500">
                <p class="serif text-base sm:text-lg md:text-xl text-gray-400 italic font-light">
                    “在信息传输中，每经过一层协议转换，信号就会产生衰减”
                </p>
                <!-- English: Decoded Core (Truth) -->
                <div class="flex flex-col gap-2 opacity-70 hover:opacity-100 transition-opacity duration-500">
                    <p class="serif text-lg sm:text-xl md:text-2xl text-gray-400 font-light">
                        Sra. when you are trying to understand, you are trying to love
                    </p>
                </div>
            </div>
    </header>

    <!-- 
        主容器
        使用 Grid 布局，桌面端分为主内容区和侧边栏
        移动端自动切换为单列布局
    -->
    <div class="main-container">
        <!-- ========== 主内容区 ========== -->
        <main>
            <!-- 
                实时信号截获模块
                position: relative：为绝对定位的子元素提供基准
                overflow: hidden：隐藏溢出内容
            -->
            <section class="content-card" style="position: relative; overflow: hidden;">
                <!-- 
                    背景水印文字 "LIVE FEED"
                    absolute：绝对定位
                    opacity-[0.02]：非常低的不透明度，作为微妙的背景装饰
                    pointer-events-none：不响应鼠标事件
                    select-none：不可选中
                -->
                <div
                    class="absolute top-0 right-0 text-[60px] sm:text-[80px] md:text-[120px] font-bold opacity-[0.02] pointer-events-none select-none mono leading-none text-[var(--primary)]">
                    LIVE FEED
                </div>

                <!-- 终端标题栏 -->
                <div class="terminal-header">
                    <h2 class="text-2xl font-bold mono uppercase tracking-widest">
                        <!-- LIVE 标签 -->
                        <span class="tag">LIVE</span> Signal Intercept // 实时信号截获
                    </h2>
                    <!-- 右侧信息：目标和信号指示器 -->
                    <div class="flex items-center gap-6 mono text-xs">
                        <div>TARGET: <span class="text-[var(--accent)]">S-Class [IRON]</span></div>
                        <!-- 
                            信号强度指示器
                            三个信号条，通过不同的 animation-delay 创建错落的跳动效果
                        -->
                        <div class="signal-indicator">
                            <div class="signal-bar" style="animation-delay: 0.1s; background: var(--accent)"></div>
                            <div class="signal-bar" style="animation-delay: 0.3s; background: var(--accent)"></div>
                            <div class="signal-bar" style="animation-delay: 0.2s; background: var(--accent)"></div>
                        </div>
                    </div>
                </div>

                <!-- 
                    聊天历史记录容器
                    id="chatbox"：JavaScript 通过这个 ID 来操作这个元素
                    包含两条预设的对话消息
                -->
                <div class="chat-history-container" id="chatbox">
                    <!-- 哨兵消息（AI 的消息，左对齐） -->
                    <div class="message-row message-sentinel">
                        <!-- 消息元信息：发送者和图标 -->
                        <div class="message-meta">
                            <span class="text-xl">⚔️</span> <span>[SENTINEL_S-04] // INCOMING STREAM</span>
                        </div>
                        <!-- 消息气泡：包含实际消息内容 -->
                        <div class="message-bubble">
                            <p class="text-gray-300 text-lg">
                                操作员 Meng，我检测到你的逻辑层存在 42ms 的犹豫迟延。你在试图隐藏什么？
                            </p>
                            <!-- 技术页脚：显示信号纯度等技术信息 -->
                            <div class="tech-footer flex justify-between text-[var(--accent)]/70">
                                <span>SIGNAL PURITY: 94%</span>
                                <span>TRANSLATION: LOSSY</span>
                            </div>
                        </div>
                    </div>

                    <!-- 操作员消息（用户的消息，右对齐） -->
                    <div class="message-row message-operator">
                        <div class="message-meta">
                            <span>[OPERATOR_MENG] // UPLINK</span>
                            <span class="text-[var(--primary)]">>>></span>
                        </div>
                        <div class="message-bubble">
                            <p class="text-[var(--primary)] text-lg">
                                那不是犹豫，那是计算。我正在"衰减"你们的秩序。
                            </p>
                            <div class="tech-footer text-[var(--primary)]/70">
                                <span>UPLOAD STATUS: COMPLETED</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 
                    终端输入区域
                    用户在这里输入命令并发送
                -->
                <div class="terminal-input-area mt-6">
                    <!-- 终端提示符 -->
                    <span class="input-prompt">MENG@M3PRO:~$</span>

                    <!-- 
                        命令输入框
                        id="userInput"：JavaScript 通过这个 ID 获取用户输入
                        placeholder：输入框为空时显示的提示文字
                        aria-label：无障碍标签，帮助屏幕阅读器理解这个元素
                    -->
                    <input type="text" id="userInput" class="command-input" placeholder="Inject Command Protocol..."
                        aria-label="Command input field">

                    <!-- 执行按钮：点击后发送消息 -->
                    <button id="sendBtn" class="execute-btn" aria-label="Execute command">[EXECUTE]</button>
                </div>
            </section>


            <!-- ========== Roadmap 模块：开发拓扑 ========== -->
            <section class="content-card">
                <h2 class="text-2xl font-bold mono mb-8">
                    <span class="tag">00</span> Roadmap // 开发拓扑
                </h2>

                <!-- 两列布局：左侧时间线，右侧终端输出 -->
                <div class="grid md:grid-cols-2 gap-10">
                    <!-- 左列：开发阶段时间线 -->
                    <div class="space-y-6">
                        <!-- Phase 01：已完成 -->
                        <div class="relative pl-6 border-l border-[var(--primary)]">
                            <!-- 时间线圆点 -->
                            <div class="absolute -left-[5px] top-0 w-2 h-2 bg-[var(--primary)] rounded-full"></div>
                            <p class="mono text-xs text-[var(--primary)]">PHASE_01</p>
                            <p class="font-bold">LLM 角色核心构建</p>
                            <p class="text-xs text-gray-500">基于 Lorebook 的记忆碎片提取，实现动态 Context 注入。</p>
                        </div>

                        <!-- Phase 02：未完成 -->
                        <div class="relative pl-6 border-l border-white/20">
                            <p class="mono text-xs text-gray-600">PHASE_02</p>
                            <p class="font-bold text-gray-600">可视化波形交互</p>
                        </div>
                    </div>

                    <!-- 右列：系统扫描终端输出 -->
                    <div class="bg-black/40 p-6 rounded mono text-[11px] text-[var(--blue)]">
                        <p class="mb-2">>>>> SYSTEM_SCAN_START...</p>
                        <p class="opacity-70 mb-1">Checking Memory... [DONE]</p>
                        <p class="opacity-70 mb-1">Injecting RAG Truth Particles... [98%]</p>
                        <p class="opacity-70 mb-1">Signal Loss Coefficient: 0.42</p>
                        <!-- 闪烁的光标 -->
                        <p class="text-[var(--primary)] mt-4 cursor-blink">_</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- ========== 侧边栏：状态面板 ========== -->
        <aside class="sidebar">
            <div class="status-panel">
                <!-- 面板标题 -->
                <p class="mono mb-4 text-[var(--primary)] font-bold">// TERMINAL STATUS</p>

                <!-- 状态信息列表 -->
                <div class="status-row"><span>OPERATOR</span> <span class="status-value">THE GUIDE</span></div>
                <div class="status-row"><span>PROTOCOL</span> <span class="status-value">S&G 2.1</span></div>
                <div class="status-row"><span>LATENCY</span> <span class="status-value">42ms</span></div>
                <div class="status-row"><span>LOCATION</span> <span class="status-value">03_ISLAND</span></div>
                <div class="status-row">
                    <span>SIGNAL</span>
                    <span class="status-value" style="color:var(--accent)">STABLE</span>
                </div>

                <!-- 警告信息 -->
                <div class="mt-8 p-4 bg-[var(--red)]/10 border border-[var(--red)]/20 text-[10px] text-[var(--red)]">
                    <strong>ATTENTION:</strong>
                    信号衰减达到阈值后，通信层将自动解构。
                </div>
            </div>

            <!-- 页脚版权信息 -->
            <footer class="mt-10 px-4 text-[10px] mono text-gray-700">
                <p>© 2026 SIGNAL ATTENUATION BIBLIO</p>
                <p>DO NOT DISTRIBUTE</p>
            </footer>
        </aside>
    </div>

    <!-- 
        背景音乐
        autoplay：页面加载后自动播放
        loop：循环播放
        muted：初始静音（某些浏览器要求自动播放必须静音）
        id="bgMusic"：JavaScript 可以通过这个 ID 控制音乐
    -->
    <audio id="bgMusic" autoplay loop muted>
        <!-- 
            音频源文件
            src：音频文件路径
            type：音频文件类型（MP3 格式）
        -->
        <source src="assets/audio/SA.mp3" type="audio/mpeg">
        <!-- 如果浏览器不支持 audio 标签，显示这段文字 -->
        您的浏览器不支持音频播放。
    </audio>

    <!--
        背景音乐控制脚本
        由于浏览器的自动播放策略，需要用户交互后才能播放声音
        这段脚本会在用户第一次点击页面时启动音乐
        音量会根据播放进度变化：开始 15% → 中间 30% → 结束 15%
    -->
    <script>
        // 获取音频元素
        const bgMusic = document.getElementById('bgMusic');

        // 音量配置
        const volumeConfig = {
            min: 0.15,          // 最小音量 15%
            max: 0.30           // 最大音量 30%
        };

        // 设置初始音量
        bgMusic.volume = volumeConfig.min;

        // 根据播放进度更新音量的函数
        function updateVolumeByProgress() {
            // 获取当前播放进度（0 到 1 之间）
            const progress = bgMusic.currentTime / bgMusic.duration;

            // 如果无法获取进度（比如音频还没加载完），跳过
            if (isNaN(progress)) return;

            // 计算音量：
            // 前半段（0 → 0.5）：从 15% 渐增到 30%
            // 后半段（0.5 → 1）：从 30% 渐减到 15%
            let volume;
            if (progress <= 0.5) {
                // 前半段：线性增加
                // progress 从 0 到 0.5，映射到音量 0.15 到 0.30
                volume = volumeConfig.min + (volumeConfig.max - volumeConfig.min) * (progress / 0.5);
            } else {
                // 后半段：线性减少
                // progress 从 0.5 到 1，映射到音量 0.30 到 0.15
                volume = volumeConfig.max - (volumeConfig.max - volumeConfig.min) * ((progress - 0.5) / 0.5);
            }

            // 应用新的音量值
            bgMusic.volume = volume;
        }

        // 启动音乐的函数
        function startMusic() {
            // 取消静音
            bgMusic.muted = false;

            // 播放音乐
            bgMusic.play().catch(e => {
                console.log('音乐播放失败:', e);
            });

            // 监听音频的 timeupdate 事件，随播放进度更新音量
            // timeupdate 事件会在播放位置改变时触发（大约每 250ms 一次）
            bgMusic.addEventListener('timeupdate', updateVolumeByProgress);

            // 移除点击事件监听器，避免重复执行
            document.removeEventListener('click', startMusic);
        }

        // 监听用户的第一次点击
        // { once: true } 表示只执行一次
        document.addEventListener('click', startMusic, { once: true });
    </script>

    <!-- 
        引入 JavaScript 文件
        放在 body 结束前，确保 DOM 元素已经加载完成
    -->
    <script src="js/background.js"></script> <!-- 背景动画脚本 -->
    <script src="js/chat.js"></script> <!-- 聊天交互脚本 -->
</body>

</html>